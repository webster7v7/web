<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>websterçš„å¯¼èˆªç«™</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="/web/manifest.json">
  
  <!-- ä¸»é¢˜è‰²ï¼ˆä¼šè¢« JS åŠ¨æ€æ›´æ–°ä»¥è·Ÿéšæš—è‰²/äº®è‰²æ¨¡å¼ï¼‰ -->
  <meta name="theme-color" content="#1a1a1a" id="theme-color-meta">
  
  <!-- Apple Touch Icon -->
  <link rel="apple-touch-icon" href="/web/icons/icon-192.png">
  
  <!-- iOS PWA æ”¯æŒ -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="websterå¯¼èˆª">
  
  <!-- Windows Tile -->
  <meta name="msapplication-TileColor" content="#1a1a1a">
  <meta name="msapplication-TileImage" content="/web/icons/icon-192.png">
  
  <style>
    /* å¯æ”¹å‚æ•°ï¼šä¸»é¢˜é¢œè‰²é…ç½® */
    :root {
      --bg-color: #f5f5f5;
      --card-bg: #ffffff;
      --text-primary: #333333;
      --text-secondary: #666666;
      --shadow-color: rgba(0, 0, 0, 0.1);
      --shadow-hover: rgba(0, 0, 0, 0.2);
      --pulse-color: rgba(59, 130, 246, 0.5);
      --transition-speed: 0.3s;
    }

    :root.dark {
      --bg-color: #1a1a1a;
      --card-bg: #2d2d2d;
      --text-primary: #e5e5e5;
      --text-secondary: #a0a0a0;
      --shadow-color: rgba(0, 0, 0, 0.3);
      --shadow-hover: rgba(0, 0, 0, 0.5);
      --pulse-color: rgba(96, 165, 250, 0.6);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-primary);
      transition: background-color var(--transition-speed), color var(--transition-speed);
      padding: 20px;
      min-height: 100vh;
    }

    header {
      max-width: 1200px;
      margin: 0 auto 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
    }

    h1 {
      font-size: 2rem;
      font-weight: 600;
    }

    #theme-toggle {
      background-color: var(--card-bg);
      color: var(--text-primary);
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      transition: background-color var(--transition-speed), color var(--transition-speed), transform 0.2s;
      box-shadow: 0 2px 8px var(--shadow-color);
    }

    #theme-toggle:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px var(--shadow-hover);
    }

    #theme-toggle:active {
      transform: translateY(0);
    }

    #config-link:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px var(--shadow-hover);
    }

    #config-link:active {
      transform: translateY(0);
    }

    /* å¯æ”¹å‚æ•°ï¼šæ¡Œé¢ç«¯æ˜¾ç¤ºåˆ—æ•°ï¼ˆgrid-template-columnsï¼‰ */
    #card-container {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 24px;
    }

    /* å“åº”å¼æ–­ç‚¹ */
    @media (max-width: 1024px) {
      #card-container {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (max-width: 768px) {
      #card-container {
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
      }
      
      h1 {
        font-size: 1.5rem;
      }
    }

    /* å¯æ”¹å‚æ•°ï¼šå¡ç‰‡æœ€å°é«˜åº¦ */
    .card {
      background-color: var(--card-bg);
      border-radius: 16px;
      padding: 24px;
      min-height: 180px;
      cursor: pointer;
      transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), 
                  box-shadow 0.3s,
                  background-color var(--transition-speed);
      box-shadow: 0 2px 8px var(--shadow-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      position: relative;
      user-select: none;
    }

    /* å¯æ”¹å‚æ•°ï¼šæ‚¬åœé˜´å½±æ‰©æ•£ç¨‹åº¦å’Œç¼©æ”¾æ¯”ä¾‹ */
    .card:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 24px var(--shadow-hover);
    }

    .card.dragging {
      opacity: 0.5;
      cursor: grabbing;
    }

    .card.drag-over {
      border: 2px dashed var(--pulse-color);
      transform: scale(1.02);
    }

    .icon-wrapper {
      position: relative;
      width: 64px;
      height: 64px;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .icon-wrapper img {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      position: relative;
      z-index: 2;
    }

    .pulse-ring {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: radial-gradient(circle, var(--pulse-color) 0%, transparent 70%);
      animation: pulse 2s ease-in-out infinite;
      z-index: 1;
    }

    /* å¯æ”¹å‚æ•°ï¼šè„‰å†²å‘¨æœŸ 2sï¼Œå¯è°ƒæ•´ä¸ºå…¶ä»–å€¼ */
    @keyframes pulse {
      0%, 100% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 0.6;
      }
      50% {
        transform: translate(-50%, -50%) scale(1.8);
        opacity: 0;
      }
    }

    .card h3 {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--text-primary);
      transition: color var(--transition-speed);
    }

    .card p {
      font-size: 0.875rem;
      color: var(--text-secondary);
      transition: color var(--transition-speed);
      line-height: 1.5;
    }
  </style>
</head>
<body>
  <header>
    <h1>âœ¨ websterçš„å¯¼èˆªç«™</h1>
    <div style="display: flex; gap: 12px; align-items: center;">
      <a href="config.html" id="config-link" style="background-color: var(--card-bg); color: var(--text-primary); text-decoration: none; padding: 10px 20px; border-radius: 8px; transition: all 0.3s; box-shadow: 0 2px 8px var(--shadow-color); display: inline-flex; align-items: center; gap: 8px;">
        ğŸ› ï¸ é…ç½®
      </a>
      <button id="theme-toggle">ğŸŒ™ åˆ‡æ¢ä¸»é¢˜</button>
    </div>
  </header>

  <main id="card-container"></main>

  <footer style="max-width: 1200px; margin: 60px auto 0; text-align: center; padding: 40px 20px; color: var(--text-secondary); transition: color var(--transition-speed); position: relative;">
    <!-- é¡¶éƒ¨è£…é¥°çº¿ -->
    <div style="width: 100%; height: 1px; background: linear-gradient(90deg, transparent, var(--border-color), transparent); margin-bottom: 30px;"></div>
    
    <!-- è£…é¥°ç‚¹ç‚¹ -->
    <div style="display: flex; justify-content: center; gap: 8px; margin-bottom: 20px;">
      <span style="width: 6px; height: 6px; border-radius: 50%; background: linear-gradient(135deg, #3b82f6, #8b5cf6); opacity: 0.6;"></span>
      <span style="width: 6px; height: 6px; border-radius: 50%; background: linear-gradient(135deg, #3b82f6, #8b5cf6); opacity: 0.8;"></span>
      <span style="width: 6px; height: 6px; border-radius: 50%; background: linear-gradient(135deg, #3b82f6, #8b5cf6);"></span>
      <span style="width: 6px; height: 6px; border-radius: 50%; background: linear-gradient(135deg, #3b82f6, #8b5cf6); opacity: 0.8;"></span>
      <span style="width: 6px; height: 6px; border-radius: 50%; background: linear-gradient(135deg, #3b82f6, #8b5cf6); opacity: 0.6;"></span>
    </div>
    
    <!-- å¼€å‘è€…ä¿¡æ¯ -->
    <div>
      <span style="font-size: 0.875rem; display: block; margin-bottom: 12px; letter-spacing: 1px;">å¼€å‘è€… / Developer</span>
      <span style="font-size: 2rem; font-weight: bold; background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; letter-spacing: 3px; display: inline-block;">WEBSTER</span>
    </div>
    
    <!-- åº•éƒ¨è£…é¥°ç‚¹ç‚¹ -->
    <div style="display: flex; justify-content: center; gap: 8px; margin-top: 20px;">
      <span style="width: 6px; height: 6px; border-radius: 50%; background: linear-gradient(135deg, #3b82f6, #8b5cf6); opacity: 0.6;"></span>
      <span style="width: 6px; height: 6px; border-radius: 50%; background: linear-gradient(135deg, #3b82f6, #8b5cf6); opacity: 0.8;"></span>
      <span style="width: 6px; height: 6px; border-radius: 50%; background: linear-gradient(135deg, #3b82f6, #8b5cf6);"></span>
      <span style="width: 6px; height: 6px; border-radius: 50%; background: linear-gradient(135deg, #3b82f6, #8b5cf6); opacity: 0.8;"></span>
      <span style="width: 6px; height: 6px; border-radius: 50%; background: linear-gradient(135deg, #3b82f6, #8b5cf6); opacity: 0.6;"></span>
    </div>
  </footer>

  <script>
    // å¯æ”¹å‚æ•°ï¼šåœ¨æ­¤æ·»åŠ /åˆ é™¤/ä¿®æ”¹ç½‘å€å¡ç‰‡
    const SITE_CONFIG = [
      {
            "id": "google",
            "name": "Google",
            "url": "https://www.google.com",
            "icon": "https://www.google.com/favicon.ico",
            "description": "å…¨çƒæœ€å¤§çš„æœç´¢å¼•æ“"
      },
      {
            "id": "github",
            "name": "GitHub",
            "url": "https://github.com",
            "icon": "https://github.com/favicon.ico",
            "description": "ä»£ç æ‰˜ç®¡ä¸åä½œå¹³å°"
      },
      {
            "id": "stackoverflow",
            "name": "Stack Overflow",
            "url": "https://stackoverflow.com",
            "icon": "https://stackoverflow.com/favicon.ico",
            "description": "ç¨‹åºå‘˜é—®ç­”ç¤¾åŒº"
      },
      {
            "id": "site_1761315107455_2f5789j6r",
            "name": "æˆæœæ±‡æŠ¥å®",
            "url": "https://baogao-psi.vercel.app",
            "icon": "https://baogao-psi.vercel.app/favicon.ico",
            "description": "æš‚æ— æè¿°"
      },
      {
            "id": "site_1761319011124_bkofb36ka",
            "name": "Kimi - æ›´å¼ºå¤§çš„ AI åŠ©æ‰‹",
            "url": "https://kimi.com",
            "icon": "https://statics.moonshot.cn/kimi-web-seo/favicon.ico",
            "description": "æš‚æ— æè¿°"
      },
      {
            "id": "site_1761319275237_4ksgb0brj",
            "name": "Open WebUI",
            "url": "https://webui.13145207.xyz",
            "icon": "https://webui.13145207.xyz/static/favicon.png",
            "description": "æš‚æ— æè¿°"
      },
      {
            "id": "site_1762011605182_7lp13pnr9",
            "name": "blog",
            "url": "https://blog.webster7v7.top",
            "icon": "https://blog.webster7v7.top/favicon.ico",
            "description": "ä¸ªäººåšå®¢"
      }
];

    // æœ¬åœ°å­˜å‚¨é”®å
    const STORAGE_KEYS = {
      ORDER: 'nav-sites-order',
      THEME: 'nav-theme-mode'
    };

    // æ‹–æ‹½çŠ¶æ€
    let draggedElement = null;
    let draggedId = null;

    // è·å–é»˜è®¤å›¾æ ‡ï¼ˆSVG data URIï¼‰
    function getDefaultIcon() {
      return 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23999"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/></svg>';
    }

    // åŠ è½½ä¸»é¢˜
    function loadTheme() {
      const savedTheme = localStorage.getItem(STORAGE_KEYS.THEME) || 'dark';
      if (savedTheme === 'dark') {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
      updateThemeButton();
      updateThemeColor(savedTheme === 'dark');
    }

    // ä¿å­˜ä¸»é¢˜
    function saveTheme(mode) {
      localStorage.setItem(STORAGE_KEYS.THEME, mode);
    }

    // åˆ‡æ¢ä¸»é¢˜
    function toggleTheme() {
      const isDark = document.documentElement.classList.toggle('dark');
      const mode = isDark ? 'dark' : 'light';
      saveTheme(mode);
      updateThemeButton();
      updateThemeColor(isDark);
    }

    // æ›´æ–°ä¸»é¢˜æŒ‰é’®æ–‡å­—
    function updateThemeButton() {
      const button = document.getElementById('theme-toggle');
      const isDark = document.documentElement.classList.contains('dark');
      button.textContent = isDark ? 'â˜€ï¸ åˆ‡æ¢ä¸»é¢˜' : 'ğŸŒ™ åˆ‡æ¢ä¸»é¢˜';
    }

    // æ›´æ–°ä¸»é¢˜è‰²ï¼ˆPWA åœ°å€æ é¢œè‰²è·Ÿéšï¼‰
    function updateThemeColor(isDark) {
      const metaThemeColor = document.getElementById('theme-color-meta');
      const color = isDark ? '#1a1a1a' : '#f5f5f5';
      if (metaThemeColor) {
        metaThemeColor.setAttribute('content', color);
      }
    }

    // åŠ è½½æ’åº
    function loadOrder() {
      const savedOrder = localStorage.getItem(STORAGE_KEYS.ORDER);
      if (!savedOrder) return [...SITE_CONFIG];

      try {
        const orderIds = JSON.parse(savedOrder);
        const orderedSites = [];
        const siteMap = new Map(SITE_CONFIG.map(site => [site.id, site]));

        // æŒ‰ä¿å­˜çš„é¡ºåºé‡å»ºæ•°ç»„
        orderIds.forEach(id => {
          if (siteMap.has(id)) {
            orderedSites.push(siteMap.get(id));
            siteMap.delete(id);
          }
        });

        // æ·»åŠ æ–°å¢çš„ç½‘ç«™ï¼ˆä¸åœ¨ä¿å­˜é¡ºåºä¸­çš„ï¼‰
        siteMap.forEach(site => orderedSites.push(site));

        return orderedSites;
      } catch (e) {
        console.error('åŠ è½½æ’åºå¤±è´¥:', e);
        return [...SITE_CONFIG];
      }
    }

    // ä¿å­˜æ’åº
    function saveOrder() {
      const cards = document.querySelectorAll('.card');
      const order = Array.from(cards).map(card => card.dataset.id);
      localStorage.setItem(STORAGE_KEYS.ORDER, JSON.stringify(order));
    }

    // åˆ›å»ºå•ä¸ªå¡ç‰‡
    function createCard(site) {
      const card = document.createElement('div');
      card.className = 'card';
      card.draggable = true;
      card.dataset.id = site.id;

      card.innerHTML = `
        <div class="icon-wrapper">
          <img src="${site.icon}" alt="${site.name}" loading="lazy">
          <div class="pulse-ring"></div>
        </div>
        <h3>${site.name}</h3>
        <p>${site.description}</p>
      `;

      // å›¾æ ‡åŠ è½½å¤±è´¥å¤„ç†
      const img = card.querySelector('img');
      img.onerror = function() {
        this.src = getDefaultIcon();
      };

      // ç‚¹å‡»æ‰“å¼€ç½‘å€
      card.addEventListener('click', (e) => {
        if (!card.classList.contains('dragging')) {
          window.open(site.url, '_blank');
        }
      });

      // ç»‘å®šæ‹–æ‹½äº‹ä»¶
      card.addEventListener('dragstart', handleDragStart);
      card.addEventListener('dragover', handleDragOver);
      card.addEventListener('dragenter', handleDragEnter);
      card.addEventListener('dragleave', handleDragLeave);
      card.addEventListener('drop', handleDrop);
      card.addEventListener('dragend', handleDragEnd);

      return card;
    }

    // æ¸²æŸ“æ‰€æœ‰å¡ç‰‡
    function renderCards() {
      const container = document.getElementById('card-container');
      container.innerHTML = '';
      
      const orderedSites = loadOrder();
      orderedSites.forEach(site => {
        const card = createCard(site);
        container.appendChild(card);
      });
    }

    // æ‹–æ‹½å¼€å§‹
    function handleDragStart(e) {
      draggedElement = this;
      draggedId = this.dataset.id;
      this.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/html', this.innerHTML);
    }

    // æ‹–æ‹½ç»è¿‡
    function handleDragOver(e) {
      if (e.preventDefault) {
        e.preventDefault();
      }
      e.dataTransfer.dropEffect = 'move';
      return false;
    }

    // æ‹–æ‹½è¿›å…¥
    function handleDragEnter(e) {
      if (this !== draggedElement) {
        this.classList.add('drag-over');
      }
    }

    // æ‹–æ‹½ç¦»å¼€
    function handleDragLeave(e) {
      this.classList.remove('drag-over');
    }

    // æ”¾ä¸‹
    function handleDrop(e) {
      if (e.stopPropagation) {
        e.stopPropagation();
      }

      if (draggedElement !== this) {
        // è·å–æ‰€æœ‰å¡ç‰‡
        const allCards = Array.from(document.querySelectorAll('.card'));
        const draggedIndex = allCards.indexOf(draggedElement);
        const targetIndex = allCards.indexOf(this);

        // äº¤æ¢ä½ç½®
        if (draggedIndex < targetIndex) {
          this.parentNode.insertBefore(draggedElement, this.nextSibling);
        } else {
          this.parentNode.insertBefore(draggedElement, this);
        }

        // ä¿å­˜æ–°é¡ºåº
        saveOrder();
      }

      this.classList.remove('drag-over');
      return false;
    }

    // æ‹–æ‹½ç»“æŸ
    function handleDragEnd(e) {
      this.classList.remove('dragging');
      
      // æ¸…ç†æ‰€æœ‰æ‹–æ‹½æ ·å¼
      document.querySelectorAll('.card').forEach(card => {
        card.classList.remove('drag-over', 'dragging');
      });

      draggedElement = null;
      draggedId = null;
    }

      // æ³¨å†Œ Service Workerï¼ˆPWA ç¦»çº¿æ”¯æŒï¼‰
    async function registerServiceWorker() {
      if ('serviceWorker' in navigator) {
        try {
          const registration = await navigator.serviceWorker.register('/web/serviceworker.js');
          console.log('âœ… Service Worker æ³¨å†ŒæˆåŠŸ:', registration.scope);

          // ç›‘å¬æ›´æ–°
          registration.addEventListener('updatefound', () => {
            const newWorker = registration.installing;
            newWorker.addEventListener('statechange', () => {
              if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                console.log('ğŸ”„ å‘ç°æ–°ç‰ˆæœ¬ï¼åˆ·æ–°é¡µé¢å³å¯æ›´æ–°');
                // å¯é€‰ï¼šæ˜¾ç¤ºæ›´æ–°æç¤ºç»™ç”¨æˆ·
              }
            });
          });
        } catch (error) {
          console.error('âŒ Service Worker æ³¨å†Œå¤±è´¥:', error);
        }
      }
    }

    // åˆå§‹åŒ–
    function init() {
      // åŠ è½½å¹¶åº”ç”¨ä¸»é¢˜
      loadTheme();

      // æ¸²æŸ“å¡ç‰‡
      renderCards();

      // ç»‘å®šä¸»é¢˜åˆ‡æ¢æŒ‰é’®
      document.getElementById('theme-toggle').addEventListener('click', toggleTheme);

      // æ³¨å†Œ Service Workerï¼ˆPWA æ”¯æŒï¼‰
      registerServiceWorker();
    }

    // DOM åŠ è½½å®Œæˆååˆå§‹åŒ–
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>

